<!DOCTYPE HTML> 
<style>
	body {
		margin: 0px;
		padding: 0px;
		overflow-x: hidden;
		font-size: 12px;
	}
	
	#log-wrapper {
		width: 800px;
	}

	#log {
		padding: 10px;
	}

	code {
		color: #666666;
	}

	code em {
		color: #444444;
		font-style: normal;
		font-weight: bold;
	}

	ul {
		list-style: none;
		margin: 0;
		padding: 0;
	}

	ul#main-list {
		float: left;
		width: 100%;
	}

	strong, span.count {
		color: #666666;
		cursor: pointer;
		font-family: Verdana, sans-serif;
		font-weight: normal;
	}


	span.count {
		color: #ffffff;
		font-weight: bold;
		margin-left: 10px;
		padding: 0px 3px;
		background-color: #ff3333;
	}

	span.count.zero {
		background-color: #33cc33;
	}

	li.level_1 {
		background: #fefefe;
		border-top: 1px dotted #eeeeee;
		border-bottom: 1px dotted #eeeeee;
		padding: 1%;
		width: 98%;
		float: left;
	}

	ul.output {
		display: none;
		padding: 5px 0;
		float: left;
		width: 100%;
	}

		ul.output li {
			float: left;
			padding: 0 1%;
			width: 98%;
		}


</style>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>

<div id="log-wrapper">
	<ul id="main-list"></ul>
</div>

<script>
	
	chrome.tabs.executeScript(null, {file:"action.js"});
	chrome.extension.onRequest.addListener(function(data, sender, resp) {
		if (data.origin == "action") {
			$.each(data, function(key, value) {
				if (key != "origin") {
					buildList(key, value);
				}
			});
		} else {
			console.log(data);
		}
	});

	function buildList(listName, listValues) {
		var dom = '<li class="level_1"><strong>' + listValues[0] + '</strong>';
		var errors_count = listValues.length - 1;
		dom += '<span id="' + listName + '-count" class="count' + ((errors_count == 0)?" zero":"") + '">' + errors_count + '</span>';
		dom += '<ul id="' + listName + '-output" class="output">';

		if (errors_count > 0) {
			for (var i = 1; i <= errors_count; i++) {
				dom += '<li><code style="display: block"><em>[' + listValues[i][0] + ']</em> ';
					dom += listValues[i][1].replace(/</g, "&lt;").replace(/>/g, "&gt;");
					dom += '</code></li>';
			}
		}

		dom += '</ul></li>';

		$("#main-list").append(dom);
	}

</script>

<script>

(function() {
	$(document).ready(function() {
		$("#main-list").on("click", "strong, span.count", function() {
			if ($(this).parent().children(".count").text() != "0") {
				var slideTime = $(this).parent().children("ul").children("li").size();
				$(this).parent().children("ul").slideToggle(slideTime * 5);
			}
		});
	});
})(jQuery)

</script>

